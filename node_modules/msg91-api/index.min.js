function generateOTP(t){for(var e="0123456789",o="",n=e.length,i=0;i<t;i++)o+=e[Math.floor(Math.random()*n)];return o}function validateMobileNos(t){if(null==t||""==t)throw new Error("MSG91 : Mobile No is not provided.");return t=t instanceof Array?t.join(","):t}function validateTemplate(t){if(null==t||""==t)throw new Error("MSG91 : template id is not provided.");return t}function modifyCallbackIfNull(t){return t||function(){}}function isData(t){return t?"object"==typeof t?JSON.stringify(t):t:null}function makeHttpRequest(t,e,o){var n=require("https"),i="",n=n.request(t,function(t){t.setEncoding("utf8"),t.on("data",function(t){i+=t}),t.on("end",function(){try{i=JSON.parse(i),o(null,i)}catch(t){o(t)}})});n.on("error",function(t){o(t)}),null!=e&&n.write(e),n.end()}module.exports=function(a){if(null==a||""==a)throw new Error("MSG91 Authorization Key not provided.");return this.otp_length=4,this.otp_expiry=1440,this.retry_type="voice",this.sendSMS=function(t,o){o=modifyCallbackIfNull(o),t=isData(t),makeHttpRequest({method:"POST",hostname:"api.msg91.com",port:null,path:"/api/v5/flow/",headers:{"Content-Type":"application/JSON",authkey:a}},t,function(t,e){o(t,e)})},this.setOtpExpiry=function(t){this.otp_expiry=t},this.setOtpLength=function(t){this.otp_length=t},this.sendOTP=function(t,e,o,n,i){"function"==typeof n&&(i=n,n=null),i=modifyCallbackIfNull(i),t=validateMobileNos(t),e=validateTemplate(e),n=isData(n),o.otp?o.otp_expiry||(o.otp_expiry=this.otp_expiry):(o.otp=generateOTP(this.otp_length),o.otp_expiry=this.otp_expiry);o=Object.entries(o||{}).map(([t,e])=>t+"="+e).join("&"),e="template_id="+e+"&mobile="+t+"&authkey="+a;o&&(e+="&"+o),makeHttpRequest({method:"GET",hostname:"api.msg91.com",port:null,path:"/api/v5/otp?"+e,headers:{"Content-Type":"application/JSON"}},n,function(t,e){i(t,e)})},this.verifyOTP=function(t,e,o){e={otp:e,otp_expiry:this.otp_expiry},o=modifyCallbackIfNull(o),t=validateMobileNos(t),e=Object.entries(e).map(([t,e])=>t+"="+e).join("&"),t="mobile="+t+"&authkey="+a;e&&(t+="&"+e),makeHttpRequest({method:"GET",hostname:"api.msg91.com",port:null,path:"/api/v5/otp/verify?"+t,headers:{}},null,function(t,e){o(t,e)})},this.resendOTP=function(t,e,o){"function"==typeof e&&(o=e,e=this.retry_type),o=modifyCallbackIfNull(o),t=validateMobileNos(t),makeHttpRequest({method:"GET",hostname:"api.msg91.com",port:null,path:"/api/v5/otp/retry?"+("authkey="+a+"&mobile="+t+"&retrytype="+e),headers:{}},null,function(t,e){o(t,e)})},this.getBalance=function(t,o){1==arguments.length&&(o=t,t=null),o=modifyCallbackIfNull(o),makeHttpRequest({method:"GET",port:null,hostname:"api.msg91.com",path:"/api/balance.php?"+("authkey="+a+"&type="+(t||1)),headers:{}},null,function(t,e){o(t,e)})},this};
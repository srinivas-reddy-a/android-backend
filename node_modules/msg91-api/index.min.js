function generateOTP(t){for(var e="",n="0123456789".length,o=0;o<t;o++)e+="0123456789"[Math.floor(Math.random()*n)];return e}function validateMobileNos(t){if(null==t||""==t)throw new Error("MSG91 : Mobile No is not provided.");return t instanceof Array&&(t=t.join(",")),t}function validateTemplate(t){if(null==t||""==t)throw new Error("MSG91 : template id is not provided.");return t}function modifyCallbackIfNull(t){return t||function(){}}function isData(t){return t?"object"==typeof t?JSON.stringify(t):t:null}function makeHttpRequest(t,e,n){var o="",i=require("https").request(t,function(t){t.setEncoding("utf8"),t.on("data",function(t){o+=t}),t.on("end",function(){o=JSON.parse(o),n(null,o)})});i.on("error",function(t){n(t)}),null!=e&&i.write(e),i.end()}module.exports=function(t){if(null==t||""==t)throw new Error("MSG91 Authorization Key not provided.");return this.otp_length=4,this.otp_expiry=1440,this.retry_type="voice",this.sendSMS=function(e,n){n=modifyCallbackIfNull(n),e=isData(e),makeHttpRequest({method:"POST",hostname:"api.msg91.com",port:null,path:"/api/v5/flow/",headers:{"Content-Type":"application/JSON",authkey:t}},e,function(t,e){n(t,e)})},this.setOtpExpiry=function(t){this.otp_expiry=t},this.setOtpLength=function(t){this.otp_length=t},this.sendOTP=function(e,n,o,i,a){"function"==typeof i&&(a=i,i=null),a=modifyCallbackIfNull(a),e=validateMobileNos(e),n=validateTemplate(n),i=isData(i),o.otp?o.otp_expiry||(o.otp_expiry=this.otp_expiry):(o.otp=generateOTP(this.otp_length),o.otp_expiry=this.otp_expiry);var l=Object.entries(o||{}).map(function(t){t.join("=")}).join("&"),p="template_id="+n+"&mobile="+e+"&authkey="+t;l&&(p+="&"+l),makeHttpRequest({method:"GET",hostname:"api.msg91.com",port:null,path:"/api/v5/otp?"+p,headers:{"Content-Type":"application/JSON"}},i,function(t,e){a(t,e)})},this.verifyOTP=function(e,n,o){var i={otp:n,otp_expiry:this.otp_expiry};o=modifyCallbackIfNull(o),e=validateMobileNos(e);var a=Object.entries(i||{}).map(function(t){t.join("=")}).join("&"),l="mobile="+e+"&authkey="+t;a&&(l+="&"+a),makeHttpRequest({method:"GET",hostname:"api.msg91.com",port:null,path:"/api/v5/otp/verify?"+l,headers:{}},null,function(t,e){o(t,e)})},this.resendOTP=function(e,n,o){"function"==typeof n&&(o=n,n=this.retry_type),o=modifyCallbackIfNull(o),e=validateMobileNos(e),makeHttpRequest({method:"GET",hostname:"api.msg91.com",port:null,path:"/api/v5/otp/retry?"+("authkey="+t+"&mobile="+e+"&retrytype="+n),headers:{}},null,function(t,e){o(t,e)})},this.getBalance=function(e,n){1==arguments.length&&(n=e,e=null),n=modifyCallbackIfNull(n),makeHttpRequest({method:"GET",port:null,hostname:"api.msg91.com",path:"/api/balance.php?"+("authkey="+t+"&type="+(e||1)),headers:{}},null,function(t,e){n(t,e)})},this};